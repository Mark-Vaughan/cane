function testLinearKirchoffLoveShellMultipatchAnalysis(testCase)
%% Licensing
%
% License:         BSD License
%                  cane Multiphysics default license: cane/license.txt
%
% Main authors:    Andreas Apostolatos
%
%% Function definition
%
% Test the linear Kirchoff-Love shell isogeometric analysis over the 
% 4-patch semispherical shell with internal pressure solved with the
% penalty and the Lagrange Multipliers methods
%
% Function layout :
%
% 0. Read input
%
% 1. Define the multipatch geometry
%
% 2. Define the material constants
%
% 3. GUI
%
% 4. Refinement
%
% 5. Define boundary conditions
%
% 6. Create the patches and the Lagrange Multiplier fields
%
% 7. Solve the linear coupled system using the penalty method
%
% 8. Solve the linear coupled system using the Lagrange Multipliers method
%
% 9. Verify the results
%
%% Function main body

%% 0. Read input

% Define tolerances for the check
absTol = 1e-15;
absTolRelaxed3 = 1e3*absTol;
absTolRelaxed6 = 1e6*absTol;
absTolRelaxed5 = 1e5*absTol;

% Define the expected solution in terms of displacements
expSolDispPenalty = [  0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
      -0.000131354519274
      -0.030552029449812
       0.023218249864009
       0.016059246029281
      -0.031840119690926
       0.019476136272472
       0.014855654519457
      -0.002583848844329
       0.007619800453624
      -0.000120654733160
       0.000904032446019
       0.000026460875630
       0.000012798856008
      -0.022057177651347
       0.062998122502040
       0.020890516498193
      -0.020373534577474
       0.061546225238519
       0.033567611914686
      -0.004750831901927
       0.022222139469659
       0.000113020701878
       0.001177064205780
      -0.000506647667937
       0.000204178371435
       0.000324474438997
       0.063782259164256
       0.021020491067995
       0.000369819148172
       0.062899128232069
       0.033049543723284
      -0.000094147105675
       0.023845338654465
       0.000196724252908
       0.000089772350705
      -0.000343547224319
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
       0.000066015774873
       0.011119117946824
       0.007758285503162
       0.001694079725867
       0.011268389996061
       0.006650115387988
       0.005074988208852
       0.009980196739046
       0.005907044418178
       0.006499029532215
       0.006284661341499
       0.004639952914453
       0.004946095739782
       0.002214995966065
       0.002952195606164
       0.001733386622971
      -0.000054191285777
       0.001080039478544
       0.000012341424514
       0.000004635582789
       0.000017009067948
       0.000259502887941
       0.026143013318943
       0.026074323923411
       0.005032154295092
       0.026743204344703
       0.025008111771644
       0.013546938377341
       0.024186110608014
       0.022328266193912
       0.017896868948514
       0.015947204835671
       0.016868536609333
       0.014286889735183
       0.005989798780439
       0.009781379713518
       0.005215227432326
      -0.000094874209945
       0.003214997660440
       0.000033121335741
       0.000010730111200
       0.000051257435421
       0.000271145884887
       0.028779298518821
       0.044046278748758
       0.006675928966681
       0.028786886854691
       0.043542243394044
       0.018331829464674
       0.026215036801762
       0.039410931732945
       0.025156946761861
       0.018207767179052
       0.029894199191532
       0.021513898909713
       0.007452369020417
       0.016947177653020
       0.008411974693664
      -0.000027502333997
       0.005223884165352
       0.000046584706895
       0.000001723810493
       0.000054577094759
       0.000267129440228
       0.020579670895191
       0.056963134935311
       0.007125308063060
       0.020400462940058
       0.056171315339298
       0.019897542942115
       0.018526220800390
       0.050991922096457
       0.028130579942490
       0.013356070580564
       0.039300751203341
       0.025621896688066
       0.005938997830822
       0.022692474855881
       0.010760043021186
       0.000073547165190
       0.006903267127631
       0.000057199096219
      -0.000007334455508
      -0.000013311727608
       0.000307245989350
       0.007551689250212
       0.063020483603311
       0.007163566325068
       0.007760142540344
       0.062112277672401
       0.019944332747847
       0.007080045553183
       0.056192447067368
       0.028405415235898
       0.005201828887097
       0.043631532997371
       0.027031875381298
       0.002506654823156
       0.025973206261561
       0.011919044765918
       0.000139128727380
       0.008133473730908
       0.000074436850821
       0.000003685146170
      -0.000189712189810
       0.000183717108825
       0.000850082010778
       0.063847802986326
       0.007821552289188
       0.000971748201949
       0.063339736871078
       0.019858504904563
       0.000897085256417
       0.056966693483647
       0.028313232820724
       0.000698469847219
       0.043937733274836
       0.026839161307443
       0.000435780937367
       0.026592490928179
       0.011951534748618
       0.000175514583153
       0.008407245031332
       0.000082018131762
       0.000020913235087
      -0.000272484935067
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
      -0.000077628913988
       0.014296379715852
       0.009889212508117
      -0.002859639499075
       0.014650302046905
       0.008337200172824
      -0.007757821108470
       0.011462776758833
       0.007040069144183
      -0.007576956649723
       0.004520603334970
       0.004616783627710
      -0.002765422189790
      -0.000079187658462
       0.001677581434597
      -0.000019233300388
      -0.000017009209813
       0.000043602104238
      -0.000217464416317
       0.029678469002898
       0.033378855015440
      -0.007486032121540
       0.030269042535487
       0.032460678338295
      -0.019421054545148
       0.024821655463698
       0.027171097837724
      -0.020646145031475
       0.010944054802828
       0.016111950751164
      -0.008229572851621
      -0.000026608172488
       0.004851390735643
      -0.000044458956206
      -0.000050810150029
       0.000147857216301
      -0.000357792541030
       0.025087033257173
       0.053379191550268
      -0.008959509660686
       0.024784235762997
       0.052723390404461
      -0.024122386636203
       0.020836790021258
       0.044858702994643
      -0.027956502889445
       0.010398002089637
       0.027028232010367
      -0.012712710091417
       0.000197150403055
       0.007626880320425
      -0.000056034413868
      -0.000076932585149
       0.000206554856906
      -0.000291616828952
       0.009459169071016
       0.062918025451717
      -0.009173662164655
       0.009345704804740
       0.061614342193160
      -0.024629042930088
       0.007939834828414
       0.052779243361177
      -0.029780823001939
       0.004400466588856
       0.032890945305523
      -0.015027923153313
       0.000187191014649
       0.009609053236203
      -0.000077811833406
      -0.000036158420359
       0.000135361643905
      -0.000459074401485
       0.000754806107444
       0.063796202977828
      -0.009081069971331
       0.000504669487235
       0.063029387876025
      -0.025167924709231
       0.000623882836582
       0.053243204648064
      -0.029239246812321
       0.000515448719513
       0.033625898507460
      -0.015097813443810
       0.000126101205170
       0.009962417872887
      -0.000086066937895
       0.000005671986784
       0.000090953807984
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
      -0.000341341843983
      -0.019675507030392
       0.014447783562332
      -0.005892838825241
      -0.020613904757973
       0.011460379823001
      -0.012223663934885
      -0.011363471487439
       0.008364850138037
      -0.005347177743144
       0.000266478585869
       0.003028813100206
      -0.000013826568450
       0.000025439935506
       0.000076809314833
      -0.000674673689965
      -0.029917706093679
       0.044651696001039
      -0.012369541036404
      -0.030924676164715
       0.044754013283610
      -0.028309951840341
      -0.019920020806958
       0.031125894674809
      -0.015257793797893
      -0.000405465003832
       0.008461078522816
      -0.000017172774388
       0.000214816857750
       0.000239153268321
      -0.000539261657960
      -0.013141252287383
       0.063383333162061
      -0.012427418704407
      -0.011844352849821
       0.061524184422513
      -0.031205756009466
      -0.008384155322232
       0.044997286566340
      -0.020738753310472
      -0.000624699883181
       0.012952051353302
      -0.000073621531621
       0.000206294608922
       0.000121971444120
      -0.000375783110064
       0.000056161805780
       0.063750445079559
      -0.012676468280890
      -0.000102016138709
       0.062915195381752
      -0.031047722541369
       0.000065751688443
       0.045306200210909
      -0.020617337719248
      -0.000098122729888
       0.013921439784974
      -0.000123061235854
       0.000048420966990
      -0.000005807327752];
                  
expSolDispLM = 1e6*[   0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
      -0.000000000324080
      -0.000000039281346
       0.000000023732852
       0.000000015930518
      -0.000000030622444
       0.000000020244507
       0.000000015708217
      -0.000000002902864
       0.000000007390576
       0.000000000042605
       0.000000000989179
      -0.000000000080485
      -0.000000000198465
      -0.000000023181597
       0.000000069173942
       0.000000018361907
      -0.000000019738911
       0.000000059534396
       0.000000039109033
      -0.000000005450482
       0.000000025162878
       0.000000000158497
       0.000000001967744
      -0.000000001791525
      -0.000000000140562
      -0.000000000229423
       0.000000078318067
       0.000000024012260
       0.000000001822394
       0.000000068354515
       0.000000040918799
      -0.000000001233840
       0.000000026551935
      -0.000000000036501
       0.000000001199402
      -0.000000002106388
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
      -0.000000000026886
       0.000000015410116
       0.000000007168266
       0.000000001764132
       0.000000013197940
       0.000000006948849
       0.000000004921863
       0.000000009983827
       0.000000005996470
       0.000000006214723
       0.000000006031987
       0.000000004728547
       0.000000005013166
       0.000000002198318
       0.000000002974704
       0.000000002099114
      -0.000000000029659
       0.000000001072428
       0.000000000007985
      -0.000000000065358
       0.000000000028412
       0.000000000148680
       0.000000031315872
       0.000000028095269
       0.000000004999409
       0.000000029913584
       0.000000026240927
       0.000000013058285
       0.000000024040131
       0.000000022624038
       0.000000017228537
       0.000000015251476
       0.000000016949501
       0.000000014641610
       0.000000005982723
       0.000000009960138
       0.000000006325610
      -0.000000000019336
       0.000000003169768
       0.000000000016816
      -0.000000000191263
       0.000000000101700
      -0.000000000148625
       0.000000033908765
       0.000000048614103
       0.000000006661489
       0.000000031244203
       0.000000046220955
       0.000000017700890
       0.000000025744591
       0.000000039865952
       0.000000024710394
       0.000000017423911
       0.000000030178453
       0.000000022670765
       0.000000007561329
       0.000000017427460
       0.000000010240640
       0.000000000095733
       0.000000005105948
       0.000000000009971
      -0.000000000318408
       0.000000000177437
       0.000000000271688
       0.000000024281131
       0.000000064311113
       0.000000007265947
       0.000000022095330
       0.000000060876533
       0.000000019971919
       0.000000018114859
       0.000000052610921
       0.000000029071553
       0.000000012821334
       0.000000040642773
       0.000000028315121
       0.000000006266830
       0.000000023665317
       0.000000013172581
       0.000000000191829
       0.000000006642174
      -0.000000000009806
      -0.000000000416706
       0.000000000248373
      -0.000000000461873
       0.000000009152097
       0.000000075212784
       0.000000007721880
       0.000000008446911
       0.000000070703983
       0.000000021834628
       0.000000006777554
       0.000000060776642
       0.000000032195102
       0.000000004588755
       0.000000047189134
       0.000000031841977
       0.000000003096351
       0.000000027325568
       0.000000014688122
       0.000000000125479
       0.000000007643618
      -0.000000000029668
      -0.000000000465086
       0.000000000298273
       0.000000000199288
       0.000000000119099
       0.000000078308431
       0.000000008455892
       0.000000001227198
       0.000000074280949
       0.000000023155666
       0.000000000134461
       0.000000063435870
       0.000000033989507
      -0.000000000281168
       0.000000048837677
       0.000000032868306
       0.000000001252040
       0.000000027689022
       0.000000014737330
      -0.000000000015592
       0.000000007919249
      -0.000000000032072
      -0.000000000460189
       0.000000000303677
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
      -0.000000000007853
       0.000000019442767
       0.000000009237022
      -0.000000002917835
       0.000000016416775
       0.000000008810693
      -0.000000007393261
       0.000000011051614
       0.000000007099599
      -0.000000007405522
       0.000000004332768
       0.000000004706514
      -0.000000003384834
      -0.000000000038094
       0.000000001694170
      -0.000000000010121
       0.000000000018703
      -0.000000000010912
       0.000000000125472
       0.000000034667911
       0.000000036668096
      -0.000000007407187
       0.000000032740987
       0.000000033829936
      -0.000000018493959
       0.000000023756363
       0.000000027146574
      -0.000000020541485
       0.000000010552197
       0.000000016354080
      -0.000000010116596
       0.000000000062470
       0.000000005026397
      -0.000000000010846
      -0.000000000001943
      -0.000000000020577
      -0.000000000116579
       0.000000029940782
       0.000000059226748
      -0.000000008942370
       0.000000026060257
       0.000000055694853
      -0.000000023531358
       0.000000020061786
       0.000000045207308
      -0.000000029265269
       0.000000010193356
       0.000000028033915
      -0.000000015799871
       0.000000000247322
       0.000000007842257
       0.000000000024777
      -0.000000000065020
      -0.000000000084624
       0.000000000137191
       0.000000010948917
       0.000000074369673
      -0.000000009792085
       0.000000010153812
       0.000000068472193
      -0.000000026687071
       0.000000007820192
       0.000000056578695
      -0.000000034231136
       0.000000004325663
       0.000000035331390
      -0.000000018955590
       0.000000000148884
       0.000000009545127
       0.000000000071759
      -0.000000000064024
      -0.000000000233579
      -0.000000000265269
       0.000000000544874
       0.000000078308777
      -0.000000010445903
       0.000000000171290
       0.000000073368271
      -0.000000029646992
       0.000000000406582
       0.000000060055173
      -0.000000035818881
       0.000000000216676
       0.000000036427089
      -0.000000019133032
       0.000000000120256
       0.000000009745375
       0.000000000089900
      -0.000000000052087
      -0.000000000327086
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
                       0
      -0.000000000173677
      -0.000000025607355
       0.000000014991174
      -0.000000006208190
      -0.000000021402694
       0.000000011672277
      -0.000000011495868
      -0.000000010535938
       0.000000008448427
      -0.000000006310623
       0.000000000051178
       0.000000003058145
      -0.000000000023424
       0.000000000018742
       0.000000000034994
      -0.000000000388216
      -0.000000034995673
       0.000000047410622
      -0.000000011919401
      -0.000000031197583
       0.000000045358221
      -0.000000027173342
      -0.000000018688193
       0.000000030904492
      -0.000000018300351
      -0.000000000795610
       0.000000009090149
      -0.000000000008889
       0.000000000234851
       0.000000000039624
       0.000000000043816
      -0.000000014744782
       0.000000072545584
      -0.000000012494675
      -0.000000012307760
       0.000000065104096
      -0.000000033559153
      -0.000000008163275
       0.000000047602948
      -0.000000025783733
      -0.000000000615632
       0.000000013382116
       0.000000000060421
       0.000000000199271
      -0.000000000110110
      -0.000000000347459
       0.000000000460990
       0.000000078311893
      -0.000000014316679
       0.000000000220210
       0.000000071865336
      -0.000000037334772
       0.000000000403563
       0.000000050771773
      -0.000000026098329
       0.000000000037137
       0.000000013172942
       0.000000000087401
       0.000000000032395
       0.000000000005349
       0.046532154789045
      -0.004592675368096
       0.004618571113493
       0.004304208213242
      -0.038222600261747
       0.044705409089114
      -0.054046568662038
      -0.044243158343381
       0.045869608203115
      -0.000006250595026
       0.000038720837407
       0.000021251083622
       0.004069608289597
       0.048609397228846
      -0.006715077795319
       6.430001706164695
       0.040728715991008
       4.125452746870018
       4.480804620314056
       0.038082435774222
       7.019594861264482
       0.800329355992248
       0.023357254856477
       7.851481228746439
      -4.021459091921540
      -0.001577831237327
       6.418866516738674
      -8.929128242875080
       0.000010675941847
       0.003566882867457
      -0.000002715419665
      -0.325325206063223
       0.000003060525275
      -0.660190425547845
      -0.020813132245913
      -0.000420179983061
       0.001309752623448
      -0.018598394922162
       0.030725945680152
       0.019510470676450
       0.001609366612799
       0.040044947492037
       0.056605424461655
       0.057164948511806
       0.046947596967327
       0.054283488875871
       0.000001754965243
      -0.000089558516145
       0.000000045186133
       0.001322779968656
      -0.000014916182461
       0.004112865912123
       0.044955226176604
      -0.051189753744272
      -0.144276154758175
       0.037203888941174
       0.112854168400823
      -0.061822437793500
       0.005516537845170
       0.149548957828493
       0.134853972802530
       0.000023870064854
       0.004043290959169
      -0.000025616533136
      -0.009533063441439];
  
expSolForcesPenalty = 1e3*[0.041610755050276
                           0.170235024130461
                          -0.668013377374186
                           0.106144991090254
                          -0.188840633455263
                          -1.309898344026627
                          -0.050122833411768
                          -0.042157192232603
                          -1.379382095093921
                          -0.251113970651992
                          -0.005567570594518
                          -0.770006489636434
                           0.137869919409573
                          -0.585313387389733
                           0.402413226210738
                           0.589406010013730
                          -0.770750780784967
                           0.529904688637543
                           0.589406010013727
                          -0.417324464668679
                           0.286917893597026
                           0.137869919409571
                          -0.029408302229412
                           0.020218723904975
                           0.137869919409573
                          -0.402413226210742
                           0.585313387389667
                           0.589406010013730
                          -0.529904688637543
                           0.770750780784966
                           0.589406010013517
                          -0.286917893597029
                           0.417324464668678
                           0.137869919409588
                          -0.020218723904976
                           0.029408302229407
                           0.071335237504037
                          -0.071736942216361
                           0.374354414939611
                           0.304964403335357
                          -0.094464444886476
                           0.492956361192685
                           0.304964403335349
                          -0.051147951938912
                           0.266912151980250
                           0.071335237504059
                          -0.003604328421600
                           0.018808945793236
                           0.004164601563486
                          -0.288518218470801
                          -0.314000408049386
                          -0.001361257931641
                          -0.020604982836523
                          -0.575227863504986
                          -0.038950915456558
                          -0.069552324762430
                          -0.856750002663121
                          -0.091684613633649
                          -0.088829245842268
                          -0.875939986699700
                          -0.140286069903287
                          -0.068163019681473
                          -0.873927011455458
                          -0.123820570624270
                          -0.022915466299161
                          -0.595685399306109
                          -0.383095422130513
                          -0.011565030582695
                          -0.308078414570405
                           0.008407110416389
                           0.111185451873846
                           0.026111150280261
                           0.051966653799456
                           0.217081435005552
                           0.050980104653552
                           0.140665861881058
                           0.278377919189303
                           0.065375168784682
                           0.178715653954403
                           0.182353661462390
                           0.042824522258541
                           0.140665861881050
                           0.077504041117408
                           0.018201299098368
                           0.051966653799501
                           0.014884824824471
                           0.003495600290536
                           0.008407110416382
                           0.000823077757794
                           0.000193294236358
                           0.012898164317918
                           0.155494916755768
                           0.078479905240267
                           0.079727088923556
                           0.303592413364571
                           0.153226255427612
                           0.215809155655451
                           0.389316683446130
                           0.196492188058444
                           0.274185035847036
                           0.255024977920462
                           0.128713764531185
                           0.215809155655312
                           0.108390839077249
                           0.054705986260986
                           0.079727088923551
                           0.020816703606408
                           0.010506407286698
                           0.012898164318045
                           0.001151089511043
                           0.000580966874275
                           0.013218020309257
                           0.126132943124272
                           0.126132943124323
                           0.081704206475754
                           0.246265314692031
                           0.246265314692026
                           0.221160913449851
                           0.315802343349690
                           0.315802343349688
                           0.280984431814494
                           0.206868827010156
                           0.206868827010152
                           0.221160913449911
                           0.087923488598641
                           0.087923488598654
                           0.081704206475723
                           0.016885903068742
                           0.016885903068797
                           0.013218020309180
                           0.000933730252111
                           0.000933730252157
                           0.012898164317917
                           0.078479905240262
                           0.155494916755799
                           0.079727088923555
                           0.153226255427612
                           0.303592413364570
                           0.215809155655452
                           0.196492188058442
                           0.389316683446129
                           0.274185035847047
                           0.128713764531191
                           0.255024977920463
                           0.215809155655478
                           0.054705986260989
                           0.108390839077234
                           0.079727088923605
                           0.010506407286690
                           0.020816703606405
                           0.012898164318016
                           0.000580966874258
                           0.001151089511040
                           0.008407110416388
                           0.026111150280240
                           0.111185451873855
                           0.051966653799456
                           0.050980104653552
                           0.217081435005553
                           0.140665861881057
                           0.065375168784680
                           0.278377919189301
                           0.178715653954399
                           0.042824522258539
                           0.182353661462380
                           0.140665861880904
                           0.018201299098364
                           0.077504041117445
                           0.051966653799266
                           0.003495600290643
                           0.014884824824428
                           0.008407110416485
                           0.000193294236463
                           0.000823077757786
                           0.004059504502430
                           0.004061098745630
                           0.055315161646765
                           0.025092910004294
                           0.007928997261266
                           0.107998793596331
                           0.067922707251457
                           0.010167878974967
                           0.138494014633456
                           0.086295643324487
                           0.006660549679333
                           0.090721601528556
                           0.067922707251706
                           0.002830870036123
                           0.038558538823426
                           0.025092910004248
                           0.000543674935922
                           0.007405253811275
                           0.004059504502213
                           0.000030063286101
                           0.000409484140717
                          -0.005398410012377
                          -0.233280572715011
                          -0.382430850652195
                          -0.001848348795592
                          -0.001307038401635
                          -0.714376715393315
                           0.047570254369443
                          -0.059140106938217
                          -1.063843227772979
                           0.128517607759930
                          -0.079715606734126
                          -1.079094917132330
                           0.137614500247377
                          -0.032413277652941
                          -0.738018198171549
                           0.338511571886151
                          -0.007603726140330
                          -0.387212589369933
                          -0.016876747784575
                           0.173870284480396
                           0.052366694511378
                          -0.101674918992659
                           0.327503507772623
                           0.098638339462010
                          -0.249069880136853
                           0.374589439003194
                           0.112819799991069
                          -0.249069880136870
                           0.179377840165189
                           0.054025474140753
                          -0.101674918992704
                           0.036686475602010
                           0.011049326032300
                          -0.016876747784591
                           0.002053938201185
                           0.000618610331537
                          -0.025671123529539
                           0.227462273274236
                           0.152067965017104
                          -0.154657131731384
                           0.428449821692488
                           0.286436478273342
                          -0.378858755377283
                           0.490049036238822
                           0.327618108386658
                          -0.378858755377266
                           0.234667421295883
                           0.156884905345397
                          -0.154657131731329
                           0.047994337639712
                           0.032086205559083
                          -0.025671123529505
                           0.002687022994197
                           0.001796386331672
                          -0.025671123529539
                           0.152067965017110
                           0.227462273274169
                          -0.154657131731384
                           0.286436478273342
                           0.428449821692489
                          -0.378858755377282
                           0.327618108386659
                           0.490049036238825
                          -0.378858755377267
                           0.156884905345397
                           0.234667421295872
                          -0.154657131731403
                           0.032086205559091
                           0.047994337639705
                          -0.025671123529534
                           0.001796386331681
                           0.002687022994195
                          -0.016876747784577
                           0.052366694511391
                           0.173870284480348
                          -0.101674918992661
                           0.098638339462010
                           0.327503507772625
                          -0.249069880136861
                           0.112819799991069
                           0.374589439003196
                          -0.249069880136890
                           0.054025474140757
                           0.179377840165186
                          -0.101674918992733
                           0.011049326032300
                           0.036686475602068
                          -0.016876747784589
                           0.000618610331538
                           0.002053938201189
                          -0.008152417339666
                           0.008158641032746
                           0.088140395813742
                          -0.049114698115098
                           0.015367683815940
                           0.166021979498836
                          -0.120314745206498
                           0.017577131000950
                           0.189891340662703
                          -0.120314745206434
                           0.008417076049026
                           0.090932351549410
                          -0.049114698115035
                           0.001721466011788
                           0.018597545234590
                          -0.008152417339533
                           0.000096378426808
                           0.001041206820188
                          -0.015316357691147
                           0.127116601198689
                          -0.555995250671280
                          -0.015294354882199
                          -0.051478176628977
                          -0.943475429940090
                           0.064912767284495
                           0.024370681529473
                          -1.391466252427811
                           0.146399935038842
                           0.033410697285731
                          -0.976427000112756
                           0.299705200237844
                           0.003872747247610
                          -0.511633846632299
                          -0.041181096906206
                          -0.301581946567305
                           0.126442198929904
                          -0.230118950691177
                          -0.520175619671028
                           0.218090472356066
                          -0.447979217790084
                          -0.468032919920785
                           0.196228959458475
                          -0.230118950691170
                          -0.111104474231641
                           0.046582012592930
                          -0.041181096906206
                          -0.006521013246316
                           0.002734020598714
                          -0.061063572942400
                          -0.337438166213854
                           0.337438166213918
                          -0.341221734888744
                          -0.582021268875217
                           0.582021268875216
                          -0.664266221575056
                          -0.523679126099650
                           0.523679126099652
                          -0.341221734888768
                          -0.124314105899294
                           0.124314105899300
                          -0.061063572942408
                          -0.007296321204698
                           0.007296321204698
                          -0.041181096906197
                          -0.126442198929896
                           0.301581946567300
                          -0.230118950691173
                          -0.218090472356064
                           0.520175619671028
                          -0.447979217790066
                          -0.196228959458468
                           0.468032919920778
                          -0.230118950691158
                          -0.046582012592929
                           0.111104474231631
                          -0.041181096906218
                          -0.002734020598713
                           0.006521013246316
                          -0.020098872066013
                          -0.020134705632342
                           0.160996121144012
                          -0.112311999858639
                          -0.034728812843106
                           0.277689888383351
                          -0.218641018890438
                          -0.031247576906085
                           0.249854096150815
                          -0.112311999858644
                          -0.007417738059432
                           0.059311870609766
                          -0.020098872065993
                          -0.000435366518564
                           0.003481169382107];

expSolForcesLM = 1e5*[ 0.000725179805578
                       0.095136238591202
                      -0.006002788974010
                       0.001228688958953
                      -0.002103479181652
                      -0.013388423454364
                       0.000294503354368
                      -0.000779839652308
                      -0.013892637239989
                      -0.001450290054163
                      -0.000294497759107
                      -0.007244850633185
                       0.001378699194096
                      -0.005853133873897
                       0.004024132262107
                       0.005894060100137
                      -0.007707507807850
                       0.005299046886375
                       0.005894060100137
                      -0.004173244646687
                       0.002869178935970
                       0.001378699194096
                      -0.000294083022294
                       0.000202187239050
                       0.001378699194096
                      -0.004024132262107
                       0.005853133873897
                       0.005894060100137
                      -0.005299046886375
                       0.007707507807850
                       0.005894060100137
                      -0.002869178935970
                       0.004173244646687
                       0.001378699194096
                      -0.000202187239050
                       0.000294083022294
                       0.000713352375040
                      -0.000717369422164
                       0.003743544149396
                       0.003049644033354
                      -0.000944644448865
                       0.004929563611927
                       0.003049644033354
                      -0.000511479519389
                       0.002669121519802
                       0.000713352375040
                      -0.000036043284216
                       0.000188089457932
                      -0.000164153760729
                       6.600839384352194
                      -0.007369908657984
                      -0.000069820743786
                      -0.000218748122426
                      -0.005828690291212
                      -0.000205203141536
                      -0.000406914670351
                      -0.008742881508942
                      -0.000635519822501
                      -0.000628185452456
                      -0.008908702249605
                      -0.001137723506269
                      -0.000543661740834
                      -0.008834394268526
                      -0.000881597228448
                      -0.000169498635984
                      -0.006001517631206
                      -0.001478298535968
                       0.000162296766862
                      -0.003156769526157
                       0.000084071104164
                       0.001111854518738
                       0.000261111502803
                       0.000519666537995
                       0.002170814350055
                       0.000509801046536
                       0.001406658618811
                       0.002783779191893
                       0.000653751687847
                       0.001787156539544
                       0.001823536614624
                       0.000428245222585
                       0.001406658618811
                       0.000775040411174
                       0.000182012990984
                       0.000519666537995
                       0.000148848248244
                       0.000034956002904
                       0.000084071104164
                       0.000008230777578
                       0.000001932942363
                       0.000128981643179
                       0.001554949167557
                       0.000784799052403
                       0.000797270889236
                       0.003035924133645
                       0.001532262554276
                       0.002158091556555
                       0.003893166834461
                       0.001964921880585
                       0.002741850358470
                       0.002550249779205
                       0.001287137645312
                       0.002158091556555
                       0.001083908390772
                       0.000547059862610
                       0.000797270889237
                       0.000208167036064
                       0.000105064072867
                       0.000128981643181
                       0.000011510895110
                       0.000005809668743
                       0.000132180203093
                       0.001261329431244
                       0.001261329431243
                       0.000817042064758
                       0.002462653146921
                       0.002462653146920
                       0.002211609134499
                       0.003158023433497
                       0.003158023433497
                       0.002809844318145
                       0.002068688270102
                       0.002068688270102
                       0.002211609134498
                       0.000879234885986
                       0.000879234885986
                       0.000817042064758
                       0.000168859030687
                       0.000168859030688
                       0.000132180203094
                       0.000009337302521
                       0.000009337302521
                       0.000128981643179
                       0.000784799052402
                       0.001554949167558
                       0.000797270889235
                       0.001532262554276
                       0.003035924133645
                       0.002158091556554
                       0.001964921880584
                       0.003893166834461
                       0.002741850358471
                       0.001287137645312
                       0.002550249779205
                       0.002158091556556
                       0.000547059862610
                       0.001083908390772
                       0.000797270889238
                       0.000105064072867
                       0.000208167036064
                       0.000128981643181
                       0.000005809668743
                       0.000011510895111
                       0.000084071104164
                       0.000261111502802
                       0.001111854518739
                       0.000519666537995
                       0.000509801046536
                       0.002170814350056
                       0.001406658618811
                       0.000653751687847
                       0.002783779191893
                       0.001787156539544
                       0.000428245222585
                       0.001823536614624
                       0.001406658618811
                       0.000182012990984
                       0.000775040411174
                       0.000519666537995
                       0.000034956002907
                       0.000148848248245
                       0.000084071104156
                       0.000001932942365
                       0.000008230777578
                       0.000040595045024
                       0.000040610987456
                       0.000553151616469
                       0.000250929100043
                       0.000079289972611
                       0.001079987935964
                       0.000679227072515
                       0.000101678789749
                       0.001384940146335
                       0.000862956433244
                       0.000066605496794
                       0.000907216015285
                       0.000679227072516
                       0.000028308700361
                       0.000385585388235
                       0.000250929100043
                       0.000005436749359
                       0.000074052538113
                       0.000040595045027
                       0.000000300632861
                       0.000004094841407
                       0.000159565884969
                      -6.602136408784621
                       0.000919176900711
                      -0.000013586711026
                       0.000108564048946
                      -0.007256027039485
                       0.000191804586302
                      -0.000231024319812
                      -0.010853861591382
                       0.000952855364471
                      -0.000507430271887
                      -0.010974213851306
                       0.000930742552946
                      -0.000306818129568
                      -0.007405682510475
                       0.001129653382489
                      -0.000117911915374
                      -0.003619404987907
                      -0.000168767477846
                       0.001738702844804
                       0.000523666945114
                      -0.001016749189927
                       0.003275035077726
                       0.000986383394620
                      -0.002490698801369
                       0.003745894390032
                       0.001128197999911
                      -0.002490698801369
                       0.001793778401652
                       0.000540254741408
                      -0.001016749189927
                       0.000366864756021
                       0.000110493260323
                      -0.000168767477846
                       0.000020539382012
                       0.000006186103315
                      -0.000256711235295
                       0.002274622732741
                       0.001520679650171
                      -0.001546571317314
                       0.004284498216926
                       0.002864364782733
                      -0.003788587553773
                       0.004900490362388
                       0.003276181083866
                      -0.003788587553772
                       0.002346674212959
                       0.001568849053454
                      -0.001546571317314
                       0.000479943376397
                       0.000320862055591
                      -0.000256711235296
                       0.000026870229942
                       0.000017963863317
                      -0.000256711235295
                       0.001520679650171
                       0.002274622732743
                      -0.001546571317314
                       0.002864364782734
                       0.004284498216925
                      -0.003788587553773
                       0.003276181083867
                       0.004900490362388
                      -0.003788587553773
                       0.001568849053454
                       0.002346674212959
                      -0.001546571317314
                       0.000320862055591
                       0.000479943376397
                      -0.000256711235295
                       0.000017963863317
                       0.000026870229942
                      -0.000168767477846
                       0.000523666945114
                       0.001738702844804
                      -0.001016749189927
                       0.000986383394620
                       0.003275035077726
                      -0.002490698801369
                       0.001128197999910
                       0.003745894390032
                      -0.002490698801369
                       0.000540254741407
                       0.001793778401652
                      -0.001016749189927
                       0.000110493260323
                       0.000366864756021
                      -0.000168767477846
                       0.000006186103315
                       0.000020539382012
                      -0.000081524173397
                       0.000081586410328
                       0.000881403958138
                      -0.000491146981151
                       0.000153676838160
                       0.001660219794989
                      -0.001203147452064
                       0.000175771310009
                       0.001898913406627
                      -0.001203147452065
                       0.000084170760490
                       0.000909323515493
                      -0.000491146981152
                       0.000017214660118
                       0.000185975452346
                      -0.000081524173398
                       0.000000963784268
                       0.000010412068202
                      -0.000444382103312
                      -0.096107106197761
                      -0.005629878433181
                      -0.000262769132097
                      -0.000896085295503
                      -0.009560355593176
                       0.000305062951146
                      -0.000211113255796
                      -0.014105901887155
                       0.000951651346769
                       0.000213458234438
                      -0.009842684110698
                       0.001842148956806
                       0.000072273234374
                      -0.005008201926461
                      -0.000411810969062
                      -0.003015819465673
                       0.001264421989299
                      -0.002301189506912
                      -0.005201756196710
                       0.002180904723561
                      -0.004479792177901
                      -0.004680329199208
                       0.001962289594585
                      -0.002301189506912
                      -0.001111044742316
                       0.000465820125929
                      -0.000411810969062
                      -0.000065210132463
                       0.000027340205987
                      -0.000610635729424
                      -0.003374381662139
                       0.003374381662139
                      -0.003412217348887
                      -0.005820212688752
                       0.005820212688752
                      -0.006642662215751
                      -0.005236791260997
                       0.005236791260997
                      -0.003412217348888
                      -0.001243141058993
                       0.001243141058993
                      -0.000610635729424
                      -0.000072963212047
                       0.000072963212047
                      -0.000411810969062
                      -0.001264421989299
                       0.003015819465673
                      -0.002301189506912
                      -0.002180904723561
                       0.005201756196710
                      -0.004479792177901
                      -0.001962289594585
                       0.004680329199208
                      -0.002301189506911
                      -0.000465820125929
                       0.001111044742316
                      -0.000411810969062
                      -0.000027340205987
                       0.000065210132463
                      -0.000200988720660
                      -0.000201347056323
                       0.001609961211440
                      -0.001123119998586
                      -0.000347288128431
                       0.002776898883834
                      -0.002186410188904
                      -0.000312475769061
                       0.002498540961507
                      -0.001123119998587
                      -0.000074177380594
                       0.000593118706098
                      -0.000200988720661
                      -0.000004353665186
                       0.000034811693821
                       0.000000000000000
                      -0.000000000000000
                      -0.000000000000000
                      -0.000000000000000
                       0.000000000000000
                      -0.000000000000000
                       0.000000000000000
                      -0.000000000000000
                       0.000000000000000
                       0.000000000000000
                       0.000000000000000
                      -0.000000000000000
                      -0.000000000000000
                      -0.000000000000000
                       0.000000000000000
                      -0.000000000000000
                       0.000000000000000
                       0.000000000000000
                      -0.000000000000000
                       0.000000000000000
                       0.000000000000000
                      -0.000000000000000
                       0.000000000000000
                       0.000000000000000
                      -0.000000000000000
                       0.000000000000000
                      -0.000000000000000
                       0.000000000000000
                       0.000000000000000
                      -0.000000000000000
                      -0.000000000000000
                      -0.000000000000000
                      -0.000000000000000
                       0.000000000000000
                      -0.000000000000000
                       0.000000000000000
                       0.000000000000000
                      -0.000000000000000
                       0.000000000000000
                       0.000000000000000
                      -0.000000000000000
                       0.000000000000000
                       0.000000000000000
                      -0.000000000000000
                       0.000000000000000
                       0.000000000000000
                       0.000000000000000
                       0.000000000000000
                      -0.000000000000000
                       0.000000000000000
                      -0.000000000000000
                       0.000000000000000
                      -0.000000000000000
                       0.000000000000000
                      -0.000000000000000
                      -0.000000000000000
                       0.000000000000000
                      -0.000000000000000
                       0.000000000000000
                       0.000000000000000
                      -0.000000000000000
                       0.000000000000000
                       0.000000000000000
                      -0.000000000000000
                       0.000000000000000];
                   
expSolMinElAreaSizePenalty = [ 0.001293936786475
                               0.000074036937538
                               0.000148876380671
                               0.000367163557641];
                       
%% 1. Define the multipatch geometry

% Global variables
Radius = 0.075000000000000;

% Patch 1 :
% _________

% Polynomial degrees
p1 = 2;
q1 = 2;

% Knot vectors
Xi1 = [0 0 0 1 1 1];
Eta1 = [0 0 0 1 1 1];

% Control Point coordinates

% x-coordinates
CP1(:, :, 1) = [0      0      0
                Radius Radius Radius
                Radius Radius Radius];
         
% y-coordinates
CP1(:, :, 2) = [-Radius -Radius 0
                -Radius -Radius 0
                0       0       0];
         
% z-coordinates
CP1(:, :, 3) = [0 Radius Radius
                0 Radius Radius
                0 0      0];
       
% Weights
weight = sqrt(2)/2;
CP1(:, :, 4) = [1      weight  1
                weight weight^2 weight 
                1      weight  1];

% Find whether the geometrical basis is a NURBS or a B-Spline
isNURBS1 = false;
nxi1 = length(CP1(:, 1, 1));
neta1 = length(CP1(1, :, 1));
for i = 1:nxi1
    for j = 1:neta1
        if CP1(i, j, 4) ~= 1
            isNURBS1 = true;
            break;
        end
    end
    if isNURBS1
        break;
    end
end

% Patch 2 :
% _________

% Polynomial degrees
p2 = 2;
q2 = 2;

% Knot vectors
Xi2 = [0 0 0 1 1 1];
Eta2 = [0 0 0 1 1 1];

% Control Point coordinates

% x-coordinates
CP2(:, :, 1) = [0      0      0
                Radius Radius Radius
                Radius Radius Radius];
         
% y-coordinates
CP2(:, :, 2) = [Radius Radius 0
                Radius Radius 0
                0      0      0];
         
% z-coordinates
CP2(:, :, 3) = [0 Radius Radius
                0 Radius Radius
                0 0      0];
       
% Weights
weight = sqrt(2)/2;
CP2(:, :, 4) = [1      weight  1
                weight weight^2 weight 
                1      weight  1];
          
% Find whether the geometrical basis is a NURBS or a B-Spline
isNURBS2 = false;
nxi2 = length(CP2(:, 1, 1));
neta2 = length(CP2(1, :, 1));
for i = 1:nxi2
    for j = 1:neta2
        if CP2(i, j, 4) ~= 1
            isNURBS2 = true;
            break;
        end
    end
    if isNURBS2
        break;
    end
end

% Patch 3 :
% _________

% Polynomial degrees
p3 = 2;
q3 = 2;

% Knot vectors
Xi3 = [0 0 0 1 1 1];
Eta3 = [0 0 0 1 1 1];

% Control Point coordinates

% x-coordinates
CP3(:, :, 1) = [0       0       0
                -Radius -Radius -Radius
                -Radius -Radius -Radius];
         
% y-coordinates
CP3(:, :, 2) = [Radius Radius 0
                Radius Radius 0
                0      0      0];
         
% z-coordinates
CP3(:, :, 3) = [0 Radius Radius
                0 Radius Radius
                0 0      0];
       
% Weights
weight = sqrt(2)/2;
CP3(:, :, 4) = [1      weight  1
                weight weight^2 weight 
                1      weight  1];

% Find whether the geometrical basis is a NURBS or a B-Spline
isNURBS3 = false;
nxi3 = length(CP3(:, 1, 1));
neta3 = length(CP3(1, :, 1));
for i = 1:nxi3
    for j = 1:neta3
        if CP3(i, j, 4) ~= 1
            isNURBS3 = 1;
            break;
        end
    end
    if isNURBS3
        break;
    end
end

% Patch 4 :
% _________

% Polynomial degrees
p4 = 2;
q4 = 2;

% Knot vectors
Xi4 = [0 0 0 1 1 1];
Eta4 = [0 0 0 1 1 1];

% Control Point coordinates

% x-coordinates
CP4(:, :, 1) = [0       0       0
                -Radius -Radius -Radius
                -Radius -Radius -Radius];
         
% y-coordinates
CP4(:, :, 2) = [-Radius -Radius 0
                -Radius -Radius 0
                0       0       0];
         
% z-coordinates
CP4(:, :, 3) = [0 Radius Radius
                0 Radius Radius
                0 0      0];
       
% Weights
weight = sqrt(2)/2;
CP4(:, :, 4) = [1      weight  1
                weight weight^2 weight 
                1      weight  1];

% Find whether the geometrical basis is a NURBS or a B-Spline
isNURBS4 = false;
nxi4 = length(CP4(:, 1, 1));
neta4 = length(CP4(1, :, 1));
for i = 1:nxi4
    for j = 1:neta4
        if CP4(i, j, 4) ~= 1
            isNURBS4 = true;
            break;
        end
    end
    if isNURBS4
        break;
    end
end

%%% Coupling between patch 1 and patch 2 %%%
%%% ------------------------------------ %%%

% Lagrange multipliers field for the traction forces :
% ____________________________________________________

% Polynomial degree
pLambda12 = 1;

% Knot vector
XiLambda12 = [0 0 1 1];

% Control points weights
CPLambda12(:,4) = [1 1];

% Find whether the geometrical basis is a NURBS or a B-Spline
isNURBSLambda12 = 0;
nxiLambda12 = length(CPLambda12(:, 1, 1));
for i = 1:nxiLambda12
    if CPLambda12(i, 4) ~= 1
        isNURBSLambda12 = 1;
        break;
    end
end

% Lagrange multipliers field for the traction moments :
% _____________________________________________________

% Polynomial degree
pMu12 = 1;

% Knot vector
XiMu12 = [0 0 1 1];

% Control point weights
CPMu12(:, 4) = [1 1];

% Find whether the geometrical basis is a NURBS or a B-Spline
isNURBSMu12 = false;
nxiMu12 = length(CPMu12(:, 1, 1));
for i = 1:nxiMu12
    if CPMu12(i, 4) ~= 1
        isNURBSMu12 = true;
        break;
    end
end

%%% Coupling between patch 2 and patch 3 %%%
%%% ------------------------------------ %%%

% Lagrange multipliers field for the traction forces :
% ____________________________________________________

% Polynomial degree
pLambda23 = 1;

% Knot vector
XiLambda23 = [0 0 1 1];

% Control points weights
CPLambda23(:, 4) = [1 1];

% Find whether the geometrical basis is a NURBS or a B-Spline
isNURBSLambda23 = false;
nxiLambda23 = length(CPLambda23(:, 1, 1));
for i = 1:nxiLambda23
    if CPLambda23(i, 4) ~= 1
        isNURBSLambda23 = true;
        break;
    end
end

% Lagrange multipliers field for the traction moments :
% _____________________________________________________

% Polynomial degree
pMu23 = 1;

% Knot vector
XiMu23 = [0 0 1 1];

% Control point weights
CPMu23(:, 4) = [1 1];

% Find whether the geometrical basis is a NURBS or a B-Spline
isNURBSMu23 = false;
nxiMu23 = length(CPMu23(:, 1, 1));
for i = 1:nxiMu23
    if CPMu23(i, 4) ~= 1
        isNURBSMu23 = true;
        break;
    end
end

%%% Coupling between patch 3 and patch 4 %%%
%%% ------------------------------------ %%%

% Lagrange multipliers field for the traction forces :
% ____________________________________________________

% Polynomial degree
pLambda34 = 1;

% Knot vector
XiLambda34 = [0 0 1 1];

% Control points weights
CPLambda34(:, 4) = [1 1];

% Find whether the geometrical basis is a NURBS or a B-Spline
isNURBSLambda34 = false;
nxiLambda34 = length(CPLambda34(:, 1, 1));
for i = 1:nxiLambda34
    if CPLambda34(i, 4) ~= 1
        isNURBSLambda34 = true;
        break;
    end
end

% Lagrange multipliers field for the traction moments :
% _____________________________________________________

% Polynomial degree
pMu34 = 1;

% Knot vector
XiMu34 = [0 0 1 1];

% Control point weights
CPMu34(:,4) = [1 1];

% Find whether the geometrical basis is a NURBS or a B-Spline
isNURBSMu34 = false;
nxiMu34 = length(CPMu34(:, 1, 1));
for i = 1:nxiMu34
    if CPMu34(i, 4) ~= 1
        isNURBSMu34 = true;
        break;
    end
end

%%% Coupling between patch 1 and patch 4 %%%
%%% ------------------------------------ %%%

% Lagrange multipliers field for the traction forces :
% ____________________________________________________

% Polynomial degree
pLambda14 = 1;

% Knot vector
XiLambda14 = [0 0 1 1];

% Control points weights
CPLambda14(:, 4) = [1 1];

% Find whether the geometrical basis is a NURBS or a B-Spline
isNURBSLambda14 = false;
nxiLambda14 = length(CPLambda14(:, 1, 1));
for i = 1:nxiLambda14
    if CPLambda14(i, 4) ~= 1
        isNURBSLambda14 = true;
        break;
    end
end

% Lagrange multipliers field for the traction moments :
% _____________________________________________________

% Polynomial degree
pMu14 = 1;

% Knot vector
XiMu14 = [0 0 1 1];

% Control point weights
CPMu14(:, 4) = [1 1];

% Find whether the geometrical basis is a NURBS or a B-Spline
isNURBSMu14 = false;
nxiMu14 = length(CPMu14(:, 1, 1));
for i = 1:nxiMu14
    if CPMu14(i, 4) ~= 1
        isNURBSMu14 = true;
        break;
    end
end

%% 2. Define the material constants

% general parameters
EYoung = 2.1e6;
nue = 0.0;
thickness = .03;

% Patch 1 :
% _________

% Young's modulus
parameters1.E = EYoung;

% Poisson ratio
parameters1.nue = nue;

% Thickness of the plate
parameters1.t = thickness;

% Patch 2 :
% _________

% Young's modulus
parameters2.E = EYoung;

% Poisson ratio
parameters2.nue = nue;

% Thickness of the plate
parameters2.t = thickness;

% Patch 3 :
% _________

% Young's modulus
parameters3.E = EYoung;

% Poisson ratio
parameters3.nue = nue;

% Thickness of the plate
parameters3.t = .03;

% Patch 4 :
% _________

% Young's modulus
parameters4.E = EYoung;

% Poisson ratio
parameters4.nue = nue;

% Thickness of the plate
parameters4.t = thickness;

%% 3. UI

% On the analysis
analysis.type = 'isogeometricKirchhoffLoveShellAnalysis';

% Define linear equation system solver
solve_LinearSystem = @solve_LinearSystemMatlabBackslashSolver;

% Integration scheme
% type = 'default' : default FGI integration element-wise
% type = 'user' : manual choice of the number of Gauss points

% Patch 1 :
% _________

int1.type = 'default';
if strcmp(int1.type, 'user')
    int1.xiNGP = 6;
    int1.etaNGP = 6;
    int1.xiNGPForLoad = 6;
    int1.etaNGPForLoad = 6;
    int1.nGPForLoad = 6;
    int1.nGPError = 12;
end

% Patch 2 :
% _________

int2.type = 'default';
if strcmp(int2.type, 'user')
    int2.xiNGP = 6;
    int2.etaNGP = 6;
    int2.xiNGPForLoad = 6;
    int2.etaNGPForLoad = 6;
    int2.nGPForLoad = 6;
    int2.nGPError = 12;
end

% Patch 3 :
% _________

int3.type = 'default';
if strcmp(int3.type, 'user')
    int3.xiNGP = 6;
    int3.etaNGP = 6;
    int3.xiNGPForLoad = 6;
    int3.etaNGPForLoad = 6;
    int3.nGPForLoad = 6;
    int3.nGPError = 12;
end

% Patch 2 :
% _________

int4.type = 'default';
if strcmp(int4.type, 'user')
    int4.xiNGP = 6;
    int4.etaNGP = 6;
    int4.xiNGPForLoad = 6;
    int4.etaNGPForLoad = 6;
    int4.nGPForLoad = 6;
    int4.nGPError = 12;
end

% Interface integration :
% _______________________

intC.type = 'default';
intC.method = 'Nitsche';
if strcmp(intC.type, 'user')
    if strcmp(intC.method, 'lagrangeMultipliers')
        intC.nGP1 = 12;
        intC.nGP2 = 12;
    else
        intC.nGP = 12;
    end
    intC.nGPError = 12;
end

% On the coupling

% Compute the material matrices for the membrane and the bending part
Dm = EYoung*thickness/(1 - nue^2)*...
      [1   nue  0
       nue 1    0
       0   0    (1 - nue)/2];
Db = thickness^3/12*Dm;

%% 4. Refinement

%%%%%%%%%%%%%%%%%%%%
% Degree elevation %
%%%%%%%%%%%%%%%%%%%%

% Patch 1 :
% _________

tp1 = 0;
tq1 = 0;
[Xi1, Eta1, CP1, p1, q1] = degreeElevateBSplineSurface ...
    (p1, q1, Xi1, Eta1, CP1, tp1, tq1, '');

% Patch 2 :
% _________

tp2 = 0;
tq2 = 0;
[Xi2, Eta2, CP2, p2, q2] = degreeElevateBSplineSurface ...
    (p2, q2, Xi2, Eta2, CP2, tp2, tq2, '');

% Patch 3 :
% _________

tp3 = 0;
tq3 = 0;
[Xi3, Eta3, CP3, p3, q3] = degreeElevateBSplineSurface ...
    (p3, q3, Xi3, Eta3, CP3, tp3, tq3, '');

% Patch 2 :
% _________

tp4 = 0;
tq4 = 0;
[Xi4, Eta4, CP4, p4, q4] = degreeElevateBSplineSurface ...
    (p4, q4, Xi4, Eta4, CP4, tp4, tq4, '');

%%% Coupling between patch 1 and patch 2 %%%
%%% ------------------------------------ %%%

% Lagrange multipliers field for the traction forces :
% ____________________________________________________

tpLambda = 0;
[XiLambda12, CPLambda12, pLambda12] = degreeElevateBSplineCurve ...
    (pLambda12, XiLambda12, CPLambda12, tpLambda, '');

% Lagrange multipliers field for the traction moments :
% _____________________________________________________

tpMu = 0;
[XiMu12, CPMu12, pMu12] = degreeElevateBSplineCurve ...
    (pMu12, XiMu12, CPMu12, tpMu, '');

%%% Coupling between patch 2 and patch 3 %%%
%%% ------------------------------------ %%%

% Lagrange multipliers field for the traction forces :
% ____________________________________________________

tpLambda = 0;
[XiLambda23, CPLambda23, pLambda23] = degreeElevateBSplineCurve ...
    (pLambda23, XiLambda23, CPLambda23, tpLambda, '');

% Lagrange multipliers field for the traction moments :
% _____________________________________________________

tpMu = 0;
[XiMu23, CPMu23, pMu23] = degreeElevateBSplineCurve ...
    (pMu23, XiMu23, CPMu23, tpMu, '');

%%% Coupling between patch 3 and patch 4 %%%
%%% ------------------------------------ %%%

% Lagrange multipliers field for the traction forces :
% ____________________________________________________

tpLambda = 0;
[XiLambda34, CPLambda34, pLambda34] = degreeElevateBSplineCurve ...
    (pLambda34, XiLambda34, CPLambda34, tpLambda, '');

% Lagrange multipliers field for the traction moments :
% _____________________________________________________

tpMu = 0;
[XiMu34, CPMu34, pMu34] = degreeElevateBSplineCurve ...
    (pMu34, XiMu34, CPMu34, tpMu, '');

%%% Coupling between patch 1 and patch 4 %%%
%%% ------------------------------------ %%%

% Lagrange multipliers field for the traction forces :
% ____________________________________________________

tpLambda = 0;
[XiLambda14, CPLambda14, pLambda14] = degreeElevateBSplineCurve ...
    (pLambda14, XiLambda14, CPLambda14, tpLambda, '');

% Lagrange multipliers field for the traction moments :
% _____________________________________________________

tpMu = 0;
[XiMu14, CPMu14, pMu14] = degreeElevateBSplineCurve ...
    (pMu14, XiMu14, CPMu14, tpMu, '');

%%%%%%%%%%%%%%%%%%%%
% Knot insertion   %
%%%%%%%%%%%%%%%%%%%%

% Patch 1 :
% _________

refXi1 = 3;
refEta1 = 3;
[Xi1, Eta1, CP1] = knotRefineUniformlyBSplineSurface ...
    (p1, Xi1, q1, Eta1, CP1, refXi1, refEta1, '');

% Patch 2 :
% _________

refXi2 = 4;
refEta2 = 4;
[Xi2, Eta2, CP2] = knotRefineUniformlyBSplineSurface ...
    (p2, Xi2, q2, Eta2, CP2, refXi2, refEta2, '');

% Patch 3 :
% _________

refXi3 = 3;
refEta3 = 3;
[Xi3, Eta3, CP3] = knotRefineUniformlyBSplineSurface ...
    (p3, Xi3, q3, Eta3, CP3, refXi3, refEta3, '');

% Patch 4 :
% _________

refXi4 = 4;
refEta4 = 4;
[Xi4, Eta4, CP4] = knotRefineUniformlyBSplineSurface ...
    (p4, Xi4, q4, Eta4, CP4, refXi4, refEta4, '');

%%% Coupling between patch 1 and patch 2 %%%
%%% ------------------------------------ %%%

% Lagrange multipliers field for the traction forces :
% ____________________________________________________

nLambda12 = min(refEta1, refEta2);
[XiLambda12, CPLambda12] = knotRefineUniformlyBSplineCurve ...
    (nLambda12, pLambda12, XiLambda12, CPLambda12, '');

% Lagrange multipliers field for the traction moments :
% _____________________________________________________

nMu12 = ceil(nLambda12/2);
[XiMu12, CPMu12] = knotRefineUniformlyBSplineCurve ...
    (nMu12, pMu12, XiMu12, CPMu12, '');

%%% Coupling between patch 2 and patch 3 %%%
%%% ------------------------------------ %%%

% Lagrange multipliers field for the traction forces :
% ____________________________________________________

nLambda23 = min(refEta2, refEta3);
[XiLambda23, CPLambda23] = knotRefineUniformlyBSplineCurve ...
    (nLambda23, pLambda23, XiLambda23, CPLambda23, '');

% Lagrange multipliers field for the traction moments :
% _____________________________________________________

nMu23 = ceil(nLambda23/2);
[XiMu23, CPMu23] = knotRefineUniformlyBSplineCurve ...
    (nMu23, pMu23, XiMu23, CPMu23, '');

%%% Coupling between patch 3 and patch 4 %%%
%%% ------------------------------------ %%%

% Lagrange multipliers field for the traction forces :
% ____________________________________________________

nLambda34 = min(refEta3, refEta4);
[XiLambda34, CPLambda34] = knotRefineUniformlyBSplineCurve ...
    (nLambda34, pLambda34, XiLambda34, CPLambda34, '');

% Lagrange multipliers field for the traction moments :
% _____________________________________________________

nMu34 = ceil(nLambda34/2);
[XiMu34, CPMu34] = knotRefineUniformlyBSplineCurve ...
    (nMu34, pMu34, XiMu34, CPMu34, '');

%%% Coupling between patch 1 and patch 4 %%%
%%% ------------------------------------ %%%

% Lagrange multipliers field for the traction forces :
% ____________________________________________________

nLambda14 = min(refEta1, refEta4);
[XiLambda14, CPLambda14] = knotRefineUniformlyBSplineCurve ...
    (nLambda14, pLambda14, XiLambda14, CPLambda14, '');

% Lagrange multipliers field for the traction moments :
% _____________________________________________________

nMu14 = ceil(nLambda14/2);
[XiMu14, CPMu14] = knotRefineUniformlyBSplineCurve ...
    (nMu14, pMu14, XiMu14, CPMu14, '');

%% 5. Define boundary conditions

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Dirichlet boundary conditions %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Patch 1 :
% _________

% Homogeneous Dirichlet boundary conditions
homDOFs1 = [];
xisup1 = [0 1];
etasup1 = [0 0];
for dir = 1:3
    homDOFs1 = findDofs3D ...
        (homDOFs1, xisup1, etasup1, dir, CP1);
end

% Inhomogeneous Dirichlet boundary conditions
inhomDOFs1 = [];
valuesInhomDOFs1 = [];

% Patch 2 :
% _________

% Homogeneous Dirichlet boundary conditions
homDOFs2 = [];
xisup2 = [0 1];
etasup2 = [0 0];
for dir = 1:3
    homDOFs2 = findDofs3D ...
        (homDOFs2, xisup2, etasup2, dir, CP2);
end

% Inhomogeneous Dirichlet boundary conditions
inhomDOFs2 = [];
valuesInhomDOFs2 = [];

% Patch 3 :
% _________

% Homogeneous Dirichlet boundary conditions
homDOFs3 = [];
xisup3 = [0 1];
etasup3 = [0 0];
for dir = 1:3
    homDOFs3 = findDofs3D ...
        (homDOFs3, xisup3, etasup3, dir, CP3);
end

% Inhomogeneous Dirichlet boundary conditions
inhomDOFs3 = [];
valuesInhomDOFs3 = [];

% Patch 4 :
% _________

% Homogeneous Dirichlet boundary conditions
homDOFs4 = [];
xisup4 = [0 1];
etasup4 = [0 0];
for dir = 1:3
    homDOFs4 = findDofs3D ...
        (homDOFs4, xisup4, etasup4, dir, CP4);
end

% Inhomogeneous Dirichlet boundary conditions
inhomDOFs4 = [];
valuesInhomDOFs4 = [];

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Neumann boundary conditions   %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% General parameter
loadAmplitude = 1e6;

% Patch 1 :
% _________

FAmp1 = loadAmplitude;
NBC1.noCnd = 1;
xib1 = [0 1];
etab1 = [0 1];
dirForce1 = 'normal';
NBC1.xiLoadExtension = {xib1};
NBC1.etaLoadExtension = {etab1};
NBC1.loadAmplitude = {FAmp1};
NBC1.loadDirection = {dirForce1};
NBC1.computeLoadVct = {'computeLoadVctAreaIGAThinStructure'};
NBC1.isFollower = true;

% Patch 2 :
% _________

FAmp2 = - loadAmplitude;
NBC2.noCnd = 1;
xib2 = [0 1];
etab2 = [0 1];
dirForce2 = 'normal';
NBC2.xiLoadExtension = {xib2};
NBC2.etaLoadExtension = {etab2};
NBC2.loadAmplitude = {FAmp2};
NBC2.loadDirection = {dirForce2};
NBC2.computeLoadVct = {'computeLoadVctAreaIGAThinStructure'};
NBC2.isFollower(1, 1) = true;

% Patch 3 :
% _________

FAmp3 = loadAmplitude;
NBC3.noCnd = 1;
xib3 = [0 1];
etab3 = [0 1];
dirForce3 = 'normal';
NBC3.xiLoadExtension = {xib3};
NBC3.etaLoadExtension = {etab3};
NBC3.loadAmplitude = {FAmp3};
NBC3.loadDirection = {dirForce3};
NBC3.computeLoadVct = {'computeLoadVctAreaIGAThinStructure'};
NBC3.isFollower = true;

% Patch 4 :
% _________

FAmp4 = - loadAmplitude;
NBC4.noCnd = 1;
xib4 = [0 1];
etab4 = [0 1];
dirForce4 = 'normal';
NBC4.xiLoadExtension = {xib4};
NBC4.etaLoadExtension = {etab4};
NBC4.loadAmplitude = {FAmp4};
NBC4.loadDirection = {dirForce4};
NBC4.computeLoadVct = {'computeLoadVctAreaIGAThinStructure'};
NBC4.isFollower = true;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Interface parametrizations     %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Patch 1 :
% _________

% Connection with patch 2:
xicoup12 = [0 1];   etacoup12 = [1 1];

% Connection with patch 4:
xicoup14 = [0 0];   etacoup14 = [0 1];

% Patch 2 :
% _________

% Connection with patch 1:
xicoup21 = [0 1];   etacoup21 = [1 1];

% Connection with patch 3:
xicoup23 = [0 0];   etacoup23 = [0 1];

% Patch 3 :
% _________

% Connection with patch 2:
xicoup32 = [0 0];   etacoup32 = [0 1];

% Connection with patch 4:
xicoup34 = [0 1];   etacoup34 = [1 1];

% Patch 4 :
% _________

% Connection with patch 3:
xicoup43 = [0 1];   etacoup43 = [1 1];

% Connection with patch 1:
xicoup41 = [0 0];   etacoup41 = [0 1];

% Define connections :
% ____________________

% Number of connections
noConnections = 4;

% Define connections by patch numbers
connections.No = noConnections;
connections.xiEtaCoup = zeros(noConnections, 10);
connections.xiEtaCoup(1, :) = [1 2 xicoup12 etacoup12 xicoup21 etacoup21];
connections.xiEtaCoup(2, :) = [2 3 xicoup23 etacoup23 xicoup32 etacoup32];
connections.xiEtaCoup(3, :) = [3 4 xicoup34 etacoup34 xicoup43 etacoup43];
connections.xiEtaCoup(4, :) = [1 4 xicoup14 etacoup14 xicoup41 etacoup41];

%% 6. Create the patches and the Lagrange Multiplier fields

% Patch 1 :
% _________

patch1 = fillUpPatch ...
    (analysis, p1, Xi1, q1, Eta1, CP1, isNURBS1, parameters1, homDOFs1, ....
    inhomDOFs1, valuesInhomDOFs1, [], [], NBC1, [], [], [], [], [], int1);

% Patch 2 :
% _________

patch2 = fillUpPatch ...
    (analysis, p2, Xi2, q2, Eta2, CP2, isNURBS2, parameters2, homDOFs2, ...
    inhomDOFs2, valuesInhomDOFs2, [], [], NBC2, [], [], [], [], [], int2);

% Patch 3 :
% _________

patch3 = fillUpPatch ...
    (analysis, p3, Xi3, q3, Eta3, CP3, isNURBS3, parameters3, homDOFs3, ...
    inhomDOFs3, valuesInhomDOFs3, [], [], NBC3, [], [], [], [], [], int3);

% Patch 4 :
% _________

patch4 = fillUpPatch ...
    (analysis, p4, Xi4, q4, Eta4, CP4, isNURBS4, parameters4, homDOFs4, ...
    inhomDOFs4, valuesInhomDOFs4, [], [], NBC4, [], [], [], [], [], int4);

% Collect all patches into an array :
% ___________________________________

BSplinePatches = {patch1 patch2 patch3 patch4};

% Lagrange multipliers field for the traction forces :
% ____________________________________________________

lambda12 = fillUpLagrangeMultipliers(pLambda12, XiLambda12, CPLambda12, isNURBSLambda12);
lambda23 = fillUpLagrangeMultipliers(pLambda23, XiLambda23, CPLambda23, isNURBSLambda23);
lambda34 = fillUpLagrangeMultipliers(pLambda34, XiLambda34, CPLambda34, isNURBSLambda34);
lambda14 = fillUpLagrangeMultipliers(pLambda14, XiLambda14, CPLambda14, isNURBSLambda14);
connections.lambda = {lambda12 lambda23 lambda34 lambda14};

% Lagrange multipliers field for the traction moments :
% _____________________________________________________

mu12 = fillUpLagrangeMultipliers(pMu12, XiMu12, CPMu12, isNURBSMu12);
mu23 = fillUpLagrangeMultipliers(pMu23, XiMu23, CPMu23, isNURBSMu23);
mu34 = fillUpLagrangeMultipliers(pMu34, XiMu34, CPMu34, isNURBSMu34);
mu14 = fillUpLagrangeMultipliers(pMu14, XiMu14, CPMu14, isNURBSMu14);
connections.mu = {mu12 mu23 mu34 mu14};

%% 7. Solve the linear coupled system using the penalty method
propCouplingPenalty.alphaD = norm(Dm)*1e3*ones(4,1);
propCouplingPenalty.alphaR = norm(Db)*1e3*ones(4,1);
propCouplingPenalty.intC = intC;
[dHatPenaltyLinear, FCompletePenalty, ~, ~, ~, minElASizePenalty] = ...
    solve_DDMPenaltyIGAKirchhoffLoveShellMultipatchesLinear ...
    (BSplinePatches, connections, propCouplingPenalty, solve_LinearSystem, '');

%% 8. Solve the linear coupled system using the Lagrange Multipliers method
warning('This unit test needs to be fixed');
if false
    propCouplingLM.alphaD = 0*ones(4,1);
    propCouplingLM.alphaR = 0*ones(4,1);
    propCouplingLM.intC = intC;
    [dHatLMLinear, FCompleteLM, ~, ~, ~, ~] = ...
        solve_DDMLagrangeMultipliersIGAKLShellMultipatchesLinear ...
        (BSplinePatches, connections, propCouplingLM, solve_LinearSystem, '');
end

%% 9. Verify the results
if false
        testCase.verifyEqual(dHatPenaltyLinear, expSolDispPenalty, 'AbsTol', absTol);
        testCase.verifyEqual(FCompletePenalty, expSolForcesPenalty, 'AbsTol', absTolRelaxed3);
        testCase.verifyEqual(minElASizePenalty, expSolMinElAreaSizePenalty, 'AbsTol', absTol);
        testCase.verifyEqual(dHatLMLinear, expSolDispLM, 'AbsTol', absTolRelaxed6);
        testCase.verifyEqual(FCompleteLM, expSolForcesLM, 'AbsTol', absTolRelaxed5);
end

end